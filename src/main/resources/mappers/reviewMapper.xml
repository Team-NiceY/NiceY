<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.nicey.model.dao.ReviewDao">

    <resultMap id="shoesMap" type="Shoes">
        <result column="review_id" property="reviewId" />
        <result column="user_id" property="userId" />
        <result column="shoes_id" property="shoesId" />
        <result column="review_title" property="reviewTitle" />
        <result column="review_content" property="reviewContent" />
        <result column="upload_date" property="uploadDate" />
        <result column="edit_date" property="editDate" />
        <result column="like_cnt" property="likeCnt" />
        <result column="delete" property="delete" />
    </resultMap>

    <select id="selectReviewAll" parameterType="Shoes" resultMap="shoesMap">
        SELECT *
        FROM reviews
        WHERE review_id = ${reviewId}
    </select>

    <insert id="insertReview" parameterType="Review">
        INSERT INTO reviews (user_id, shoes_id, review_title, review_content, delete)
        VALUES (${userId} ${shoesId}, #{reviewTitle}, #{reviewContent}, 'N')
    </insert>

    <update id="updateReview" parameterType="Review">
        UPDATE reviews
        SET
            review_title = #{reviewTitle}
            review_content = #{reviewContent}
            edit_date = NOW()
        WHERE
            review_id = ${reviewId}
        AND user_id = ${userId}
    </update>
    
    <select id="selectReviewWriter" parameterType="Integer" resultType="Integer">
        SELECT user_id AS userId
        FROM reviews
        WHERE
            review_id = ${reviewId}
        AND user_id = ${userId}
    </select>

    <delete id="deleteReview" parameterType="Review">
        DELETE FROM reviews
        WHERE
            review_id = ${reviewId}
        AND user_id = ${userId}
    </delete>


</mapper>